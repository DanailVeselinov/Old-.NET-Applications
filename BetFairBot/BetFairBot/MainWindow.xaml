<Window x:Class="BetFairBot.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:local="clr-namespace:BetFairBot"
        Title="EddyBetFairBot" SizeToContent="WidthAndHeight" Loaded="Window_Loaded" Background="{DynamicResource WindowBackground}">
    <Window.Resources>
        <local:BetlineConverter x:Key="BetlinePBConverter"/>
        <local:RGBConverter x:Key="RGBConverter"/>
        <local:RGBConverterForeground x:Key="RGBConverterForeground"/>
        <local:SelectionConverter x:Key="SelectionConverter"/>
        <local:PercentPerBudjetConverter x:Key="PercentConverter"/>
        <local:IsActiveTrueConverter x:Key="IsActiveConverter"/>
    </Window.Resources>
    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition x:Name="LoginHeader" Height="Auto"/>
            <RowDefinition x:Name="MarketSelector" Height="Auto" />
            <RowDefinition x:Name="LastTransactions" />
        </Grid.RowDefinitions>
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="Auto"/>
            <ColumnDefinition Width="Auto"/>
            <ColumnDefinition Width="Auto"/>
            <ColumnDefinition Width="Auto"/>
        </Grid.ColumnDefinitions>
        <Expander Grid.Column="3" Grid.RowSpan="3" Margin="3" Name="_RunningBetsExpander" DataContext="{Binding DataContext, ElementName=_RunningBetLines}" IsExpanded="True" HorizontalAlignment="Stretch"  MinWidth="120" ExpandDirection="Down">
            <Expander.Header>
                <StackPanel Orientation="Horizontal">
                    <ComboBox ItemsSource="{Binding}" IsSynchronizedWithCurrentItem="True" SelectedIndex="0"  MinWidth="120" DisplayMemberPath="betlineName" Name="_RecentBetlinesCombo" Background="{DynamicResource TextBackground}"/>
                    <CheckBox Content="Show All" Name="_showAllCB" IsChecked="True" Click="_showAllCB_Click"/>
                </StackPanel>
            </Expander.Header>
            <StackPanel VerticalAlignment="Top" HorizontalAlignment="Left">
                <DataGrid AutoGenerateColumns="False" IsSynchronizedWithCurrentItem="True" IsReadOnly="True" ItemsSource="{Binding SelectedItem.PlacedBetsRunning, ElementName=_RecentBetlinesCombo, Converter='{StaticResource BetlinePBConverter}'}" Name="_RunningBetsGrid" MaxHeight="220" CanUserAddRows="False">
                    <DataGrid.Columns>
                        <DataGridTextColumn Header="Status" Binding="{Binding resultCode}"/>
                        <DataGridTextColumn Header="Market" Binding="{Binding marketMenuPath}"/>
                        <DataGridTextColumn Header="Score" Binding="{Binding score}"/>
                        <DataGridTextColumn Header="Bet On" Binding="{Binding Selection}"/>
                        <DataGridTextColumn Header="Price" Binding="{Binding averagePrice}"/>
                        <DataGridTextColumn Header="Size" Binding="{Binding sizeMatched}"/>
                        <DataGridTextColumn Header="Time" Binding="{Binding datePlaced,StringFormat='dd/MMM hh:mm'}"/>
                        <DataGridCheckBoxColumn Header="Won" Binding="{Binding success}"/>
                    </DataGrid.Columns>
                    <DataGrid.RowStyle>
                        <Style TargetType="DataGridRow">
                            <Setter Property="Background" Value="{Binding betlineId, Converter={StaticResource RGBConverter}}"/>
                            <Setter Property="Foreground" Value="{Binding betlineId, Converter={StaticResource RGBConverterForeground}}"/>
                        </Style>
                    </DataGrid.RowStyle>
                </DataGrid>
            </StackPanel>
        </Expander>
        <StackPanel HorizontalAlignment="Left" Orientation="Horizontal"  x:Name="_LoginPanel" Visibility="Visible" Panel.ZIndex="100">
            <UniformGrid Rows="2" Columns="6">
                <Label Content="Username" HorizontalAlignment="Right" VerticalAlignment="Center"/>
                <TextBox Height="23" TextWrapping="Wrap" Width="80" x:Name="_username" HorizontalAlignment="Right" VerticalAlignment="Center" Background="{DynamicResource TextBackground}" Text="sabina8234"/>
                <Label Content="Password" HorizontalAlignment="Right" VerticalAlignment="Center"/>
                <PasswordBox Height="23" HorizontalAlignment="Right" Width="80" x:Name="_password" VerticalAlignment="Center" Background="{DynamicResource TextBackground}" Password="Samota8234"/>
                <Label Content="AppKey" HorizontalAlignment="Right" VerticalAlignment="Center"/>
                <TextBox Height="23" TextWrapping="Wrap" Width="80" x:Name="_appKeyTB" HorizontalAlignment="Right" VerticalAlignment="Center" Background="{DynamicResource TextBackground}" Text="vBgUxOJsNetcV5I5"/>
                <Label Content="Certificate" HorizontalAlignment="Right" VerticalAlignment="Center"/>                
                <TextBox Height="23" Grid.ColumnSpan="2" TextWrapping="Wrap" Width="80" x:Name="_certFileTB" HorizontalAlignment="Right" VerticalAlignment="Center" Background="{DynamicResource TextBackground}" Text="EddyBetFairApp.p12"/>
                <Button Name="Browse" Width="50" Content="Browse" Click="Browse_Click"/>
            </UniformGrid>
            <StackPanel VerticalAlignment="Center">
                <Button Content="Login" Click="Button_Click_Login" VerticalAlignment="Top" Margin="0,5"/>
                <CheckBox Name="_rememberMe" IsChecked="True" Content="Remember Me" Margin="0,5"/>
            </StackPanel>
        </StackPanel>
        <StackPanel Grid.Row="0" HorizontalAlignment="Left" Orientation="Horizontal"  x:Name="_LoggedinPanel" Panel.ZIndex="100" Visibility="Collapsed">
            <Label Content="Welcome:" HorizontalAlignment="Right"/>
            <Label HorizontalAlignment="Left" x:Name="_userFullName"/>
            <Label Content="Funds:" HorizontalAlignment="Right"/>
            <Label HorizontalAlignment="Left" x:Name="_FundsAvailable"/>
            <Label HorizontalAlignment="Left" x:Name="_FundsBallance" Visibility="Collapsed"/>
            <Label HorizontalAlignment="Left" x:Name="_currency"/>
            <Button Click="Button_Click_1" Width="30" Height="30" >
                <Button.Background>
                    <ImageBrush ImageSource="Image/refreshBtn.png"/>
                </Button.Background>
            </Button>
            <Button Click="UpdateAllBudjets" Margin="10,0">
                <TextBlock Text="Update all Budjets" Width="50" TextAlignment="Center"  TextWrapping="Wrap"/>
            </Button>
            <Button Content="LogOut" Click="Button_Click_LogOut"/>            
        </StackPanel>
        <StackPanel Grid.Row="1" Orientation="Horizontal" HorizontalAlignment="Left" x:Name="_MarketSelectPanel" Grid.ColumnSpan="3">
            <TabControl x:Name="Filters" HorizontalContentAlignment="Left" Foreground="#FF040404" Background="{DynamicResource TabControlBackgroundBrush}">
                <TabItem Header="Prymary Filters" x:Name="_PrimaryFilterTabItem" IsSelected="True" GotFocus="_PrimaryFilterTabItem_GotFocus" >
                    <StackPanel Orientation="Horizontal">

                        <GroupBox Header="Select Event Types">
                            <StackPanel>
                                <ListView x:Name="_events" ItemsSource="{Binding}"  DisplayMemberPath="EventType.Name" ScrollViewer.VerticalScrollBarVisibility="Visible" SelectionMode="Multiple" Height="100" Background="{DynamicResource TextBackground}" />
                            </StackPanel>
                        </GroupBox>
                        <GroupBox Header="Select Country">
                            <StackPanel>
                                <ListBox ItemsSource="{Binding}"  ScrollViewer.VerticalScrollBarVisibility="Visible"  x:Name="_countryCodes" SelectionMode="Multiple" DisplayMemberPath="CountryName" Height="100" Background="{DynamicResource TextBackground}"/>
                            </StackPanel>
                        </GroupBox>
                        <GroupBox Header="Select Period Range">
                            <StackPanel>
                                <TextBlock><Run Text="From"/></TextBlock>
                                <DatePicker Text="From" x:Name="_fromEventDatePicker" Background="{DynamicResource TextBackground}"/>
                                <TextBlock><Run Text="To"/></TextBlock>

                                <DatePicker x:Name="_toEventsDatePicker" Background="{DynamicResource TextBackground}"/>
                            </StackPanel>
                        </GroupBox>
                        <StackPanel>
                            <CheckBox Content="In Play Only" IsChecked="True" x:Name="_InPlayOnlyCheckbox" Margin="0,10" />
                            <Button Content="Get Markets" VerticalAlignment="Bottom" Height="30" MinWidth="80" Click="FillPrimaryFilters"/>
                        </StackPanel>
                    </StackPanel>
                </TabItem>
                <TabItem Header="Secondary Filters" x:Name="_SecondaryFilterTabItem" Height="25" IsEnabled="False" GotFocus="_SecondaryFilterTabItem_GotFocus" >
                    <StackPanel>
                        <StackPanel HorizontalAlignment="Left" Orientation="Horizontal" >

                            <GroupBox Header="Active Filter">
                                <StackPanel x:Name="_ActiveFilter">
                                    <RadioButton Content="All"/>
                                    <RadioButton Content="Active" IsChecked="True"/>
                                    <RadioButton Content="Non Active"/>
                                </StackPanel>
                            </GroupBox>
                            <GroupBox Header="Is BSP Filter">
                                <StackPanel x:Name="_IsBSPFilter">
                                    <RadioButton Content="All"/>
                                    <RadioButton Content="BSP"/>
                                    <RadioButton Content="Non BSP" IsChecked="True"/>
                                </StackPanel>
                            </GroupBox>
                            <GroupBox Header="Exchange ID Filter">
                                <StackPanel x:Name="_ExchangeIDFilter">
                                    <RadioButton Content="All" DataContext="Null" />
                                    <RadioButton DataContext="1" Content="Worldwide/UK" IsChecked="True"/>
                                    <RadioButton DataContext="2" Content="Australian"/>
                                </StackPanel>
                            </GroupBox>
                            <GroupBox Header="Market Type Filter">
                                <StackPanel x:Name="_MarketTypeFilter">
                                    <CheckBox Content="Odds" IsChecked="True"/>
                                    <CheckBox Content="Line" IsChecked="True"/>
                                    <CheckBox Content="Fixed Odds"/>
                                    <CheckBox Content="Range"/>
                                    <CheckBox Content="Asian Handicap Singles"/>
                                    <CheckBox Content="Asian Handicap Doubles"/>
                                </StackPanel>
                            </GroupBox>
                            <GroupBox Header="Market Name">
                                <ListView SelectionMode="Multiple" ScrollViewer.VerticalScrollBarVisibility="Visible" ItemsSource="{Binding}" DisplayMemberPath="MarketName" Width="150" Height="100" SelectionChanged="_marketName_Selected"  x:Name="_marketName" Background="{DynamicResource TextBackground}">
                                </ListView>
                            </GroupBox>
                        </StackPanel>
                        <Button Content="New Betline" Height="40" Width="120" Margin="5" Click="Button_Click_NewBetLine"/>
                    </StackPanel>
                </TabItem>
                <TabItem x:Name="_BetlineTabItem" Header="Betline" IsEnabled="False" Height="29" VerticalAlignment="Bottom">
                    <StackPanel Orientation="Horizontal">
                        <GroupBox Header="Stake Range">
                            <StackPanel>
                                <TextBlock><Run Text="From"/></TextBlock>
                                <TextBox x:Name="_StakeRangeMin" Background="{DynamicResource TextBackground}"/>
                                <TextBlock><Run Text="To"/></TextBlock>
                                <TextBox x:Name="_StakeRangeMax" Background="{DynamicResource TextBackground}"/>
                                <GroupBox Header="Goal Difference" ToolTip="Goal Difference">
                                    <StackPanel Orientation="Horizontal" HorizontalAlignment="Center">
                                        <StackPanel>
                                            <TextBlock Text="Min"/>
                                            <TextBox x:Name="_goalDifferenceMin" MinWidth="35"/>
                                        </StackPanel>
                                        <StackPanel>
                                            <TextBlock Text="Max"/>
                                            <TextBox  x:Name="_goalDifferenceMax" MinWidth="35"/>
                                        </StackPanel>
                                    </StackPanel>
                                </GroupBox>
                            </StackPanel>
                        </GroupBox>
                        <StackPanel>
                            <GroupBox Header="Profit Per Budjet">
                                <StackPanel Orientation="Horizontal">
                                    <TextBox x:Name="_profitPerBetTB" Width="40" Margin="0,0,0,1" Background="{DynamicResource TextBackground}"/>
                                    <TextBlock Text="%"/>
                                    <TextBox Text="{Binding Text,ElementName=_profitPerBetTB, Mode=TwoWay,Converter={StaticResource PercentConverter},UpdateSourceTrigger=Default}" x:Name="_profitPerBudjetTB" Width="40" Margin="0,0,0,1" Background="{DynamicResource TextBackground}"/>
                                    <TextBlock Text="{Binding Content,ElementName=_currency}"/>
                                </StackPanel>
                            </GroupBox>
                            <GroupBox Header="Matched Range" ToolTip="Total Amount Matched">
                                <StackPanel Orientation="Horizontal" HorizontalAlignment="Center">
                                    <StackPanel>
                                        <TextBlock Text="Min"/>
                                        <TextBox x:Name="_totalAmmountMatchedMin" MinWidth="35" Background="{DynamicResource TextBackground}"/>
                                    </StackPanel>
                                    <StackPanel>
                                        <TextBlock Text="Max"/>
                                        <TextBox  x:Name="_totalAmmountMatchedMax" MinWidth="35" Background="{DynamicResource TextBackground}"/>
                                    </StackPanel>
                                </StackPanel>
                            </GroupBox>
                            <GroupBox Header="Bet Type" Width="100" >
                                <ComboBox HorizontalAlignment="Left" SelectedIndex="0" x:Name="_BetType" Background="{DynamicResource TextBackground}">
                                    <ComboBoxItem Content="Back"/>
                                    <ComboBoxItem Content="Lay"/>
                                </ComboBox>
                            </GroupBox>

                        </StackPanel>
                        <StackPanel>

                            <GroupBox Header="Select Algorithm">
                                <ComboBox Width="120" x:Name="_algo" SelectedIndex="0" ItemsSource="{Binding}" SelectionChanged="_algo_SelectionChanged" DisplayMemberPath="Value" Background="{DynamicResource TextBackground}"/>
                            </GroupBox>
                            <StackPanel Orientation="Vertical" HorizontalAlignment="Center">
                                <StackPanel x:Name="_maxBetsCountStack" Visibility="Collapsed">
                                    <TextBlock Text="Maximum Bets"/>
                                    <TextBox ToolTip="Number from 1 to 24" Width="40"/>
                                </StackPanel>
                                <StackPanel x:Name="_maxAmmountStack" Visibility="Collapsed">
                                    <TextBlock Text="Maximum Ammount To Bet Per Budjet %" TextWrapping="Wrap" ToolTip="Maximum Ammount to be Bet on Incrementing bets" Width="100"/>
                                    <StackPanel Orientation="Horizontal">
                                        <TextBox Width="40" x:Name="_maxAmmountPercentTB"/>
                                        <TextBlock Text="%"/>
                                        <TextBox Text="{Binding Text,ElementName=_maxAmmountPercentTB, Mode=TwoWay,Converter={StaticResource PercentConverter},UpdateSourceTrigger=Default}" x:Name="__maxAmmountTB" Width="40" Margin="0,0,0,1"/>
                                        <TextBlock Text="{Binding Content,ElementName=_currency}"/>
                                    </StackPanel>
                                </StackPanel>
                                <TextBlock Text="Betline Name"/>
                                <TextBox x:Name="betlineName" Width="100" Background="{DynamicResource TextBackground}"/>
                            </StackPanel>
                            <Button Content="Start New BetLine" Height="30" Click="Button_Click_StartNewBetLine" TabIndex="100" Margin="0,5"/>
                        </StackPanel>
                    </StackPanel>
                </TabItem>
            </TabControl>
            <StackPanel/>
        </StackPanel>
        <DataGrid  Grid.Row="2" x:Name="_RunningBetLines" CanUserAddRows="False" IsReadOnly="True" AutoGenerateColumns="False" ItemsSource="{Binding}" MouseLeftButtonUp="_RunningBetLines_MouseLeftButtonUp" IsSynchronizedWithCurrentItem="True" MouseDoubleClick="_RunningBetLines_MouseDoubleClick" Grid.ColumnSpan="3">
            <DataGrid.RowStyle>
                <Style TargetType="DataGridRow">
                    <Setter Property="Background" Value="{Binding BetlineId, Converter={StaticResource RGBConverter}}"/>
                    <Setter Property="Foreground" Value="{Binding BetlineId, Converter={StaticResource RGBConverterForeground}}"/>
                </Style>
            </DataGrid.RowStyle>
            <DataGrid.Columns>
                <DataGridTextColumn Header="ID" Binding="{Binding BetlineId}"/>
                <DataGridTextColumn Header="Name" MaxWidth="80" Binding="{Binding betlineName}"/>
                <DataGridTextColumn Header="Last Bets" Width="75" Binding="{Binding lastPlacedBetId}">
                    <DataGridTextColumn.EditingElementStyle>
                        <Style>
                            <Setter Property="TextBlock.TextWrapping" Value="Wrap" />
                            <Setter Property="TextBlock.TextTrimming" Value="CharacterEllipsis"/>
                        </Style>
                    </DataGridTextColumn.EditingElementStyle>
                </DataGridTextColumn>
                <DataGridTextColumn Header="Profit" Width="Auto" Binding="{Binding profitPerBet}"/>
                <DataGridTextColumn Header="Ballance" Width="Auto" Binding="{Binding ballance,StringFormat='0.00'}"/>
                <DataGridTemplateColumn Header="Command">
                    <DataGridTemplateColumn.CellTemplate>
                        <DataTemplate>
                            <StackPanel Orientation="Horizontal">
                                <Button Click="ResumeBetline" Padding="0" Width="25" Content=">" IsEnabled="{Binding isActive, ConverterParameter='1', Converter={StaticResource IsActiveConverter}}" ToolTip="Resume Betline" x:Name="ButtonResumeBetline"/>
                                <Button Click="PauseBetline" Padding="0" Width="25" Content="||" IsEnabled="{Binding isActive, ConverterParameter='0', Converter={StaticResource IsActiveConverter}}" ToolTip="Pause Betline" x:Name="ButtonPauseBetline"/>
                                <Button Padding="0" Width="25" IsEnabled="{Binding isActive, ConverterParameter='0', Converter={StaticResource IsActiveConverter}}" Click="StopOnWinBetline" Content="#" ToolTip="Stop on Winning Bet" x:Name="ButtonStopBetline"/>
                                <Button Click="Restart" Padding="0" Width="25" Content="&lt;--" ToolTip="Restart Betline" x:Name="ButtonRestartBetline"/>
                                <Button Click="DeleteBetline" Padding="0" Width="25" Content="X" ToolTip="Delete Betline"/>
                            </StackPanel>
                        </DataTemplate>
                    </DataGridTemplateColumn.CellTemplate>
                </DataGridTemplateColumn>
            </DataGrid.Columns>
        </DataGrid>
    </Grid>
</Window>
